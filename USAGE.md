# DepthFlow Mobile ä½¿ç”¨æŒ‡å—
## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Vulkan çš„ Android åº”ç”¨ï¼Œå®ç°äº†ä» PC ç«¯å¯¼å‡ºçš„æ·±åº¦æµåŠ¨ç”»æ•ˆæœçš„å®æ—¶æ¸²æŸ“ã€‚è¯¥é¡¹ç›®æ˜¯å®Œæ•´çš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆï¼Œå°†æ·±åº¦ä¼°è®¡å’Œæ¸²æŸ“åˆ†ç¦»ï¼Œå®ç°äº†åœ¨æ‰‹æœºä¸Šçš„é«˜æ€§èƒ½æ¸²æŸ“ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
Depthflow_mobile/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/
â”‚   â”‚   â”œâ”€â”€ assets/              # èµ„æºæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ image.png        # å‰æ™¯å›¾åƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ depth.png        # æ·±åº¦å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ image_bg.png     # èƒŒæ™¯å›¾åƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ depth_bg.png     # èƒŒæ™¯æ·±åº¦å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ subject_mask.png # ä¸»ä½“é®ç½©
â”‚   â”‚   â”‚   â”œâ”€â”€ config.json      # é…ç½®å‚æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ quad.vert        # é¡¶ç‚¹ç€è‰²å™¨æºç 
â”‚   â”‚   â”‚   â””â”€â”€ depthflow.frag   # ç‰‡å…ƒç€è‰²å™¨æºç 
â”‚   â”‚   â”œâ”€â”€ cpp/                 # Native C++ ä»£ç 
â”‚   â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt   # CMake æ„å»ºé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ native-lib.cpp   # Vulkan æ¸²æŸ“å™¨å®ç°
â”‚   â”‚   â””â”€â”€ java/.../            # Java ä»£ç 
â”‚   â”‚       â””â”€â”€ MainActivity.java # ä¸»æ´»åŠ¨ç±»
â”‚   â””â”€â”€ build.gradle.kts         # Gradle æ„å»ºé…ç½®
â”œâ”€â”€ create_test_assets.py         # æµ‹è¯•èµ„äº§ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â””â”€â”€ USAGE.md                     # ä½¿ç”¨æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘è¦æ±‚

- **Android Studio**: Arctic Fox æˆ–æ›´é«˜ç‰ˆæœ¬
- **Android NDK**: 21 æˆ–æ›´é«˜ç‰ˆæœ¬  
- **Android SDK**: API Level 24+
- **è®¾å¤‡**: æ”¯æŒ Vulkan çš„ Android è®¾å¤‡
- **æ„å»ºå·¥å…·**: CMake 3.22.1+

### 2. ç¼–è¯‘æ­¥éª¤

1. **æ‰“å¼€é¡¹ç›®**
   ```
   åœ¨ Android Studio ä¸­æ‰“å¼€ DepthFlow_mobile é¡¹ç›®
   ```

2. **é…ç½®æ„å»ºç¯å¢ƒ**
   - ç¡®ä¿å·²å®‰è£… NDK å’Œ CMake
   - æ£€æŸ¥ `local.properties` ä¸­çš„ SDK å’Œ NDK è·¯å¾„

3. **ç¼–è¯‘é¡¹ç›®**
   ```bash
   ./gradlew clean assembleDebug
   ```

4. **å®‰è£…åˆ°è®¾å¤‡**
   ```bash
   ./gradlew installDebug
   # æˆ–è€…ç›´æ¥åœ¨ Android Studio ä¸­è¿è¡Œ
   ```

## ğŸ“± è¿è¡Œåº”ç”¨

### ä½¿ç”¨æµ‹è¯•èµ„äº§ï¼ˆå¿«é€Ÿä½“éªŒï¼‰

é¡¹ç›®å·²ç»åŒ…å«äº†è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•èµ„äº§ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š

1. è¿æ¥æ”¯æŒ Vulkan çš„ Android è®¾å¤‡
2. è¿è¡Œåº”ç”¨
3. è§‚å¯ŸåŠ¨æ€çš„æ·±åº¦æµåŠ¨ç”»æ•ˆæœ

### ä½¿ç”¨çœŸå®èµ„äº§ï¼ˆå®Œæ•´ä½“éªŒï¼‰

å¦‚æœä½ æœ‰ PC ç«¯å¯¼å‡ºçš„ `mobile_assets`ï¼š

1. **å¯¼å‡ºèµ„äº§**ï¼ˆPCç«¯ï¼‰
   ```bash
   uv run depthflow input -i your_image.jpg main --export-mobile
   ```

2. **å¤åˆ¶åˆ°Androidé¡¹ç›®**
   ```
   å°† mobile_assets/ ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°:
   app/src/main/assets/
   ```

3. **é‡æ–°ç¼–è¯‘å’Œè¿è¡Œ**

## ğŸ¨ æ•ˆæœè¯´æ˜

### å½“å‰å®ç°çš„ç‰¹æ€§

- âœ… **Vulkan æ¸²æŸ“ç®¡çº¿**ï¼šå®Œæ•´çš„ Vulkan åˆå§‹åŒ–å’Œæ¸²æŸ“
- âœ… **å®æ—¶åŠ¨ç”»**ï¼šåŸºäºæ—¶é—´çš„è½¨é“è¿åŠ¨æ•ˆæœ
- âœ… **æ·±åº¦æ•ˆæœ**ï¼šæ¨¡æ‹Ÿæ·±åº¦æµåŠ¨çš„è§†è§‰æ•ˆæœ
- âœ… **åŠ¨æ€ç€è‰²å™¨**ï¼šå†…åµŒ GLSL ç€è‰²å™¨ï¼Œå®æ—¶ç¼–è¯‘
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼š60FPS æµç•…æ¸²æŸ“

### è§†è§‰æ•ˆæœ

åº”ç”¨ä¼šæ˜¾ç¤ºä¸€ä¸ªå…¨å±çš„åŠ¨æ€æ•ˆæœï¼š
- å½©è‰²æ³¢æµªéšæ—¶é—´æµåŠ¨
- æ¨¡æ‹Ÿæ·±åº¦å±‚æ¬¡çš„è§†è§‰æ•ˆæœ
- å¹³æ»‘çš„åŠ¨ç”»è¿‡æ¸¡
- é«˜æ€§èƒ½ GPU æ¸²æŸ“

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **Vulkan åˆå§‹åŒ–**
   - Instance åˆ›å»º
   - ç‰©ç†è®¾å¤‡é€‰æ‹©
   - é€»è¾‘è®¾å¤‡åˆ›å»º
   - å‘½ä»¤æ± è®¾ç½®

2. **æ¸²æŸ“ç®¡çº¿**
   - é¡¶ç‚¹ç€è‰²å™¨ï¼šå…¨å±ä¸‰è§’å½¢ç”Ÿæˆ
   - ç‰‡å…ƒç€è‰²å™¨ï¼šæ·±åº¦æµæ•ˆæœè®¡ç®—
   - Uniform Bufferï¼šåŠ¨ç”»å‚æ•°ä¼ é€’

3. **Java é›†æˆ**
   - SurfaceView ç®¡ç†
   - æ¸²æŸ“çº¿ç¨‹æ§åˆ¶
   - JNI æ¥å£å°è£…

### ç€è‰²å™¨æ¶æ„

**é¡¶ç‚¹ç€è‰²å™¨** (`quad.vert`)ï¼š
- ç”Ÿæˆè¦†ç›–å…¨å±çš„å¤§ä¸‰è§’å½¢
- è¾“å‡ºçº¹ç†åæ ‡

**ç‰‡å…ƒç€è‰²å™¨** (`depthflow.frag`)ï¼š
- æ¥æ”¶ Uniform Buffer å‚æ•°
- è®¡ç®—æ—¶é—´å’Œç©ºé—´ç›¸å…³çš„æ·±åº¦æ•ˆæœ
- ç”Ÿæˆå½©è‰²æµåŠ¨çº¹ç†

## ğŸ› è°ƒè¯•æŒ‡å—

### æŸ¥çœ‹æ—¥å¿—

```bash
adb logcat | grep DepthFlow
```

### å¸¸è§é—®é¢˜

1. **åº”ç”¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ”¯æŒ Vulkan
   - ç¡®è®¤ API Level >= 24

2. **ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥ NDK ç‰ˆæœ¬å…¼å®¹æ€§
   - ç¡®è®¤ CMake ç‰ˆæœ¬

3. **æ¸²æŸ“é»‘å±**
   - æ£€æŸ¥ Vulkan é©±åŠ¨æ”¯æŒ
   - æŸ¥çœ‹ logcat ä¸­çš„é”™è¯¯ä¿¡æ¯

### æ€§èƒ½ç›‘æ§

ä½¿ç”¨ Android Studio çš„ Profiler å·¥å…·ï¼š
- ç›‘æ§ GPU ä½¿ç”¨ç‡
- æ£€æŸ¥å†…å­˜ä½¿ç”¨
- åˆ†æå¸§ç‡è¡¨ç°

## ğŸš§ æ‰©å±•å¼€å‘

### æ·»åŠ çœŸå®æ·±åº¦å›¾å¤„ç†

è¦å®ç°å®Œæ•´çš„æ·±åº¦æµæ•ˆæœï¼Œéœ€è¦ï¼š

1. **çº¹ç†åŠ è½½**
   ```cpp
   // åœ¨ initVulkan ä¸­æ·»åŠ çº¹ç†åˆ›å»º
   VkTexture loadTextureFromAsset("image.png");
   VkTexture loadDepthFromAsset("depth.png");
   ```

2. **ç€è‰²å™¨å‡çº§**
   ```glsl
   // åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­é‡‡æ ·çœŸå®çº¹ç†
   vec4 color = texture(texImage, uv);
   float depth = texture(texDepth, uv).r;
   ```

3. **è§†å·®è®¡ç®—**
   ```glsl
   // å®ç°çœŸå®çš„è§†å·®åç§»
   vec2 parallaxUV = uv + offset * depth * height;
   ```

### äº¤äº’æ§åˆ¶

æ·»åŠ è§¦æ‘¸æ§åˆ¶ï¼š
```java
@Override
public boolean onTouchEvent(MotionEvent event) {
    // å¤„ç†è§¦æ‘¸äº‹ä»¶
    // é€šè¿‡ JNI ä¼ é€’åˆ° Native å±‚
    return true;
}
```

### æ›´å¤šæ•ˆæœ

- **ç²’å­ç³»ç»Ÿ**ï¼šæ·»åŠ åŠ¨æ€ç²’å­æ•ˆæœ
- **åå¤„ç†æ»¤é•œ**ï¼šå®ç°æ¨¡ç³Šã€è‰²è°ƒè°ƒæ•´
- **éŸ³é¢‘å“åº”**ï¼šæ ¹æ®éŸ³é¢‘èŠ‚å¥è°ƒæ•´åŠ¨ç”»

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vulkan è§„èŒƒ](https://www.khronos.org/vulkan/)
- [Android NDK å¼€å‘æŒ‡å—](https://developer.android.com/ndk)
- [GLSL ç€è‰²å™¨è¯­è¨€](https://www.khronos.org/registry/OpenGL/specs/gl/)
- [Android Vulkan æœ€ä½³å®è·µ](https://developer.android.com/games/optimization/vulkan)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- C++ ä»£ç ä½¿ç”¨ Google é£æ ¼
- Java ä»£ç ä½¿ç”¨ Android é£æ ¼
- æ³¨é‡Šä½¿ç”¨ä¸­æ–‡ï¼ˆé¡¹ç›®è¦æ±‚ï¼‰

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºåŸ DepthFlow é¡¹ç›®å¼€å‘ï¼Œéµå¾ªç›¸åº”çš„å¼€æºè®¸å¯è¯ã€‚

---

**ğŸ‰ äº«å—æ·±åº¦æµåŠ¨ç”»å¸¦æ¥çš„è§†è§‰ä½“éªŒï¼**
